import basicDemo from './basicDemo?raw'
import errorDemo from './errorDemo?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# loadImage

异步加载图片并返回加载结果。

## 详细介绍

loadImage 是一个图片预加载函数，核心作用是：**异步加载图片，返回加载结果（成功或失败）**。

**涉及的知识点**：
- `new Image()`：创建 HTMLImageElement
- `onload/onerror` 事件：监听图片加载状态
- Promise：将回调式 API 包装为 Promise

**常用场景**：
- 图片预加载：提前加载图片避免显示时闪烁
- 懒加载：进入视口后异步加载图片
- 图片校验：检测图片 URL 是否有效
- Canvas 绑定：在绑定到 Canvas 前等待加载完成

**优势**：
- Promise 形式，支持 async/await
- 返回元组 `[data, error]` 形式，便于错误处理
- 成功时可获取完整的 HTMLImageElement 对象

## 加载成功

<CodeOrSourceMdx language="typescript">
  {basicDemo}
</CodeOrSourceMdx>

## 加载失败

<CodeOrSourceMdx language="typescript">
  {errorDemo}
</CodeOrSourceMdx>

## 参数介绍

<table>
  <thead>
    <tr>
      <th>参数名</th>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>url</td>
      <td><code>string</code></td>
      <td>图片地址</td>
    </tr>
  </tbody>
</table>

### 返回值

- 类型：`Promise<[HTMLImageElement | undefined, Error | undefined]>`
- 描述：元组形式，`[image, error]`
  - 成功：`[HTMLImageElement, undefined]`
  - 失败：`[undefined, Error]`

## 具体实现原理

### 文件结构

- `index.ts` - 唯一源文件，包含 loadImage 函数实现

### 核心流程

1. 创建 `new Image()` 对象
2. 设置 `onload` 回调：resolve `[image, undefined]`
3. 设置 `onerror` 回调：resolve `[undefined, error]`
4. 设置 `img.src = url` 触发加载
5. 返回 Promise

### 关键技术点

- 使用 `new Image()` 创建离屏图片元素
- 设置 src 后浏览器自动发起请求
- 返回元组而非 reject，调用方无需 try/catch
