import indexTsx from './index.tsx?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# useUpdate

强制组件重新渲染的 Hook。

## 详细介绍

`useUpdate` 返回一个函数，调用该函数会触发组件强制重新渲染。内部通过 `useState` 设置新对象引用来触发更新。

常用于需要手动触发渲染但不依赖特定状态变化的场景，如外部数据源变化时强制刷新。

## 演示代码

<CodeOrSourceMdx language="tsx">
  {indexTsx}
</CodeOrSourceMdx>

## 返回值

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>() =&gt; void</code></td>
      <td>调用即触发组件重新渲染</td>
    </tr>
  </tbody>
</table>

## 具体实现原理

### 文件职责

- `index.ts`：实现 `useUpdate` Hook，通过创建新对象引用触发 React 重渲染

### 核心流程

1. 使用 `useState({})` 创建状态，忽略状态值本身
2. 通过 `useCallback(() => setState({}), [])` 创建稳定的更新函数
3. 调用 `setState({})` 时，由于每次传入新对象引用（`{} !== {}`），React 判定状态变化并触发重渲染

### 关键技术点

- **新对象引用**：`setState({})` 每次创建新的空对象，React 通过 `Object.is` 比较发现引用不同，触发更新
- **`useCallback`**：空依赖数组保证函数引用稳定，不会导致依赖它的子组件不必要重渲染
- **忽略状态值**：`const [, setState]` 解构忽略第一个元素，状态值不被使用

### 数据流向

```
useState({}) → [_, setState]
       ↓
useCallback(() => setState({}), []) → update 函数（引用稳定）
       ↓
调用 update() → setState({}) → 新对象引用 → React 重渲染
```
