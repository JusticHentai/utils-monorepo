import indexDemo from './index.tsx?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# onChildListChange

监听子节点变化。使用 MutationObserver 监听指定元素的子节点添加和删除。

## 详细介绍

`onChildListChange` 是基于 `MutationObserver` 封装的子节点变化监听工具。

**涉及的知识点**：
- MutationObserver API：浏览器原生的 DOM 变化监听 API
- childList 配置：监听直接子节点的添加和删除
- subtree 配置：可选择是否监听整个子树

**常用场景**：
- 动态列表监控：监听列表项的增删
- 虚拟 DOM 调试：追踪 DOM 节点的变化
- 组件生命周期：检测子组件的挂载和卸载
- 表格行监控：监听表格行的动态增删

**优势**：
- 获取所有新增和移除的节点
- 支持选择是否监听子树
- 比 DOM 事件更精确

## 使用示例

点击按钮添加或移除子节点，观察回调触发情况。

<CodeOrSourceMdx language="tsx">
  {indexDemo}
</CodeOrSourceMdx>

## 参数介绍

<table>
  <thead>
    <tr>
      <th>参数名</th>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>target</td>
      <td><code>Element | null</code></td>
      <td>要观察的目标元素</td>
    </tr>
    <tr>
      <td>callback</td>
      <td><code>OnChildListChangeCallback</code></td>
      <td>子节点变化时的回调函数</td>
    </tr>
    <tr>
      <td>subtree</td>
      <td><code>boolean</code></td>
      <td>可选，是否监听整个子树，默认为 false</td>
    </tr>
  </tbody>
</table>

### OnChildListChangeCallback

```typescript
type OnChildListChangeCallback = (
  addedNodes: Node[],
  removedNodes: Node[]
) => void
```

### 返回值

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>() =&gt; void</code></td>
      <td>清理函数，调用后停止观察</td>
    </tr>
  </tbody>
</table>

## 具体实现原理

### 文件结构

- `index.ts` - 主函数实现
- `interface.ts` - 类型定义

### 核心流程

1. 调用 `createMutationObserver` 创建观察器
2. 配置 `childList: true` 监听子节点变化
3. 收集所有 mutation 中的 addedNodes 和 removedNodes
4. 合并后一次性传递给回调函数

### 关键技术点

- 将多个 mutation 的节点合并处理
- 支持 `subtree` 配置监听深层子树变化
- 只在有实际变化时触发回调
