import basicDemo from './basicDemo?raw'
import immediateDemo from './immediateDemo?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# throttle

节流函数，用于限制函数在一定时间内只能执行一次。

## 详细介绍

节流（throttle）是一种函数调用控制策略，核心思想是：**在指定时间间隔内，无论触发多少次，函数只执行一次**。

**涉及的知识点**：
- 闭包：保存定时器引用和执行状态
- setTimeout：实现延迟执行和时间间隔控制
- 高阶函数：接收函数返回函数

**常用场景**：
- 滚动事件：限制滚动处理函数的执行频率
- 拖拽事件：限制 mousemove 回调频率
- 游戏循环：控制帧率或技能冷却
- 按钮点击：限制连续点击的触发频率

**与防抖的区别**：
- 防抖：连续触发时，只在最后一次触发后执行
- 节流：连续触发时，按固定间隔执行

**优势**：
- 保证函数按固定频率执行，不会被"饿死"
- 平滑处理高频事件，提升性能
- 用户体验更连贯，有规律的响应反馈

## 延迟执行

<CodeOrSourceMdx language="typescript">
  {basicDemo}
</CodeOrSourceMdx>

## 立即执行

<CodeOrSourceMdx language="typescript">
  {immediateDemo}
</CodeOrSourceMdx>

## 参数介绍

<table>
  <thead>
    <tr>
      <th>参数名</th>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>options.cb</td>
      <td><code>(...params: any[]) =&gt; any</code></td>
      <td>需要节流的回调函数</td>
    </tr>
    <tr>
      <td>options.duration</td>
      <td><code>number</code></td>
      <td>节流时间间隔（毫秒）</td>
    </tr>
    <tr>
      <td>options.immediate</td>
      <td><code>boolean</code></td>
      <td>是否立即执行。true: 立即执行后计时；false: 计时结束后执行</td>
    </tr>
  </tbody>
</table>

### 返回值

- 类型：`(...params: any[]) => void`
- 描述：返回节流后的函数

## 具体实现原理

### 文件结构

- `index.ts` - 唯一源文件，包含 throttle 函数实现和类型定义

### 核心流程

1. 调用 `throttle({ cb, duration, immediate })` 创建节流函数
2. 返回的函数被调用时，检查是否有正在执行的定时器
3. 有定时器则直接返回（本次调用被"节流"）
4. 无定时器则根据 `immediate` 参数决定执行时机：
   - `immediate=true`：立即执行，然后设置定时器
   - `immediate=false`：设置定时器，duration 后执行

### 关键技术点

- 使用闭包保存 `timeout` 定时器引用
- `if (timeout) return` 实现"冷却中跳过"
- `immediate` 模式使用 `!timeout` 判断是否首次调用
