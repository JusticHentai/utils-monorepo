import basicDemo from './basicDemo?raw'
import onceDemo from './onceDemo?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# visibility

监听页面可见性变化（visibilitychange）事件。

## 基础用法

监听页面的可见性变化，当页面变为可见或隐藏时触发对应的回调函数。底层使用 `document.visibilityState` 判断当前状态。

<CodeOrSourceMdx language="typescript">
  {basicDemo}
</CodeOrSourceMdx>

## 一次性监听（Safari 兼容）

设置 `once: true` 后回调只触发一次并自动移除监听。设置 `safariCompat: true` 会额外监听 `pagehide` 事件，解决 Safari 不触发 `visibilitychange` 的问题。

<CodeOrSourceMdx language="typescript">
  {onceDemo}
</CodeOrSourceMdx>

## 参数介绍

<table>
  <thead>
    <tr>
      <th>参数名</th>
      <th>类型</th>
      <th>默认值</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>options.visible</td>
      <td><code>() =&gt; void</code></td>
      <td>-</td>
      <td>页面变为可见时触发的回调函数</td>
    </tr>
    <tr>
      <td>options.hidden</td>
      <td><code>() =&gt; void</code></td>
      <td>-</td>
      <td>页面变为隐藏时触发的回调函数</td>
    </tr>
    <tr>
      <td>options.once</td>
      <td><code>boolean</code></td>
      <td><code>false</code></td>
      <td>是否只执行一次，执行后自动移除监听</td>
    </tr>
    <tr>
      <td>options.safariCompat</td>
      <td><code>boolean</code></td>
      <td><code>false</code></td>
      <td>是否兼容 Safari 的 pagehide 事件</td>
    </tr>
  </tbody>
</table>

### 返回值

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>() =&gt; void</code></td>
      <td>移除事件监听的清理函数</td>
    </tr>
  </tbody>
</table>

## 具体实现原理

- **index.ts**: 核心实现，监听 `visibilitychange` 事件，通过 `document.visibilityState` 判断页面状态。支持 `once` 模式自动清理，支持 `safariCompat` 模式额外监听 `pagehide` 事件解决 Safari 兼容问题。
- **interface.ts**: 定义 `VisibilityOptions` 接口，包含 `visible`、`hidden`、`once`、`safariCompat` 四个可选配置项。
