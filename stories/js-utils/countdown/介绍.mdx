import startCountDownDemo from './startCountDownDemo?raw'
import clearCountdownDemo from './clearCountdownDemo?raw'
import { CodeOrSourceMdx } from '@storybook/addon-docs/blocks'

# countdown

倒计时定时器函数，每秒触发回调。

## 详细介绍

countdown 是一个倒计时工具函数，核心作用是：**根据目标时间戳，每秒计算剩余时间并触发回调**。

**涉及的知识点**：
- setInterval：每秒触发定时器
- 时间戳计算：目标时间 - 当前时间 = 剩余时间
- 清理函数：返回 clearInterval 包装

**常用场景**：
- 活动倒计时：距离活动开始还有 XX:XX:XX
- 验证码倒计时：60 秒后重新获取
- 限时抢购：倒计时结束后商品下架
- 考试时间：距离考试结束还有多长时间

**优势**：
- 基于时间戳计算，不累积误差
- 返回清理函数，便于组件卸载时清除
- 回调返回剩余秒数，便于格式化显示

## 开始倒计时示例

<CodeOrSourceMdx language="typescript">
  {startCountDownDemo}
</CodeOrSourceMdx>

## 清除倒计时示例

<CodeOrSourceMdx language="typescript">
  {clearCountdownDemo}
</CodeOrSourceMdx>

## 参数介绍

<table>
  <thead>
    <tr>
      <th>参数名</th>
      <th>类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>options.endTs</td>
      <td><code>number</code></td>
      <td>结束时间戳（秒级）</td>
    </tr>
    <tr>
      <td>options.cb</td>
      <td><code>(remaining: number) =&gt; void</code></td>
      <td>每秒触发的回调，参数为剩余秒数</td>
    </tr>
  </tbody>
</table>

### 返回值

- 类型：`() => void`
- 描述：清除定时器的函数

## 具体实现原理

### 文件结构

- `index.ts` - 唯一源文件，包含 countdown 函数实现

### 核心流程

1. 计算初始剩余时间：`endTs - Math.floor(Date.now() / 1000)`
2. 立即调用一次回调
3. 启动 `setInterval`，每秒执行：
   - 重新计算剩余时间
   - 调用回调传入剩余秒数
   - 剩余时间 ≤ 0 时清除定时器
4. 返回 clearInterval 包装函数

### 关键技术点

- 每次都重新计算时间戳差值，避免累积误差
- 使用秒级时间戳：`Math.floor(Date.now() / 1000)`
- 自动清理：倒计时结束后自动清除定时器
