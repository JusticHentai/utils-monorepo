import{j as n}from"./jsx-runtime-u17CrQMm.js";/* empty css              */import{E as c,a as u}from"./index-CwqKHT5z.js";import"./index-EnvM_XjC.js";import"./index-DOJC9J_n.js";import"./index-GMzEpHqB.js";import"./index-CPTfiPhJ.js";import"./index-DL3VI9dp.js";const{action:a}=__STORYBOOK_MODULE_ACTIONS__,O=()=>{const r=new c().observe(e=>{a("捕获错误")({type:e.type,message:e.message,timestamp:e.timestamp})});a("开始监听")("已启动 JS / Resource / Promise 错误监控"),setTimeout(()=>{r(),a("监控状态")("已停止")},5e3)},{action:_}=__STORYBOOK_MODULE_ACTIONS__,R=()=>{const r=new c({jsError:!1,promiseError:!1,resourceError:!0}).observe(o=>{_("捕获资源错误")(o)}),e=document.createElement("img");e.src="https://example.invalid/not-exist.png",document.body.appendChild(e),e.addEventListener("error",()=>{document.body.removeChild(e),r(),_("演示完成")("已触发图片加载失败并停止监听")})},{action:p}=__STORYBOOK_MODULE_ACTIONS__,w=()=>{const r=new c({consoleError:!0,jsError:!1,resourceError:!1,promiseError:!1}).observe(e=>{p("捕获 console.error")(e)});console.error("模拟的 console.error 输出",{statusCode:500}),r(),p("演示完成")("已捕获 console.error 并停止监听")},{action:l}=__STORYBOOK_MODULE_ACTIONS__,C=()=>{const r=new c({consoleError:!0,errorFilter:e=>e.type===u.CONSOLE&&e.message.includes("忽略")?(l("被过滤")("该 console.error 被 errorFilter 拦截"),!1):!0}).observe(e=>{l("通过过滤的错误")(e)});console.error("这条会被忽略"),console.error("这条会通过过滤器"),r(),l("演示完成")('errorFilter 过滤了包含"忽略"的错误')},{action:i}=__STORYBOOK_MODULE_ACTIONS__,g=()=>{const t=[];window.__PRE_COLLECTED_ERRORS__=t;const r=o=>{o instanceof ErrorEvent&&o.message&&t.push({type:"JS",message:o.message,timestamp:Date.now()})},e=o=>{t.push({type:"PROMISE",message:o.reason instanceof Error?o.reason.message:String(o.reason),timestamp:Date.now()})};window.addEventListener("error",r,!0),window.addEventListener("unhandledrejection",e),i("预收集")("已启动提前错误收集"),setTimeout(()=>{throw new Error("script 加载前的错误")},100),setTimeout(()=>{const o=window.__PRE_COLLECTED_ERRORS__||[];i("预收集结果")(`共收集到 ${o.length} 个错误`),o.forEach(s=>{i("预收集的错误")({type:s.type,message:s.message,timestamp:s.timestamp})}),window.removeEventListener("error",r,!0),window.removeEventListener("unhandledrejection",e),window.__PRE_COLLECTED_ERRORS__=[];const d=new c;d.observe(s=>{i("正式监控捕获")({type:s.type,message:s.message})}),i("监控状态")("已从预收集切换到正式监控"),setTimeout(()=>{d.stop(),i("监控状态")("已停止")},5e3)},1e3)},E=()=>n.jsxs("div",{children:[n.jsx("div",{className:"button",onClick:O,children:"基础监听"}),n.jsx("div",{className:"button",onClick:R,children:"资源错误监听"}),n.jsx("div",{className:"button",onClick:w,children:"Console 错误监听"}),n.jsx("div",{className:"button",onClick:C,children:"错误过滤"}),n.jsx("div",{className:"button",onClick:g,children:"提前收集错误"})]});E.__docgenInfo={description:"",methods:[],displayName:"ErrorMonitorDemo"};const j={title:"element-utils/errorMonitor",component:E,parameters:{layout:"centered"},argTypes:{}},m={};m.parameters={...m.parameters,docs:{...m.parameters?.docs,source:{originalSource:"{}",...m.parameters?.docs?.source}}};const x=["Demo"];export{m as Demo,x as __namedExportsOrder,j as default};
