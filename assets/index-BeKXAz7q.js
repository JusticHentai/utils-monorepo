import{c as h}from"./index-BtXwjIh0.js";import{g,D as v}from"./index-DhV1O_Ae.js";import{t as f}from"./index-xKxNytmu.js";import{t as S}from"./index-QD0SLaeG.js";var c=(t=>(t.CLICK="click",t.SCROLL="scroll",t.INPUT="input",t.NAVIGATE="navigate",t.CUSTOM="custom",t))(c||{}),p=(t=>(t.PUSH_STATE="pushState",t.REPLACE_STATE="replaceState",t.POPSTATE="popstate",t.HASHCHANGE="hashchange",t))(p||{});const b="password",y=["password","pwd","secret","token","credit","card"],T=100,C=(t,s)=>{const{capture:e=!0,sampleRate:i=1}=s||{};return h(document,"click",r=>{if(i<1&&Math.random()>i)return;const u=r.target;t({type:c.CLICK,timestamp:Date.now(),pageUrl:window.location.href,target:g(u),data:{x:r.clientX,y:r.clientY,button:r.button}})},{capture:e})},L=(t,s)=>{const{recordValue:e=!1,sensitiveFields:i=y,throttleMs:l=500}=s||{},r=new WeakMap;return h(document,"input",d=>{const o=d.target;if(!o||!o?.value)return;const a=r.get(o);a&&clearTimeout(a);const n=setTimeout(()=>{const w=o.type===b||i.some(m=>o.name?.toLowerCase().includes(m)||o.id?.toLowerCase().includes(m));t({type:c.INPUT,timestamp:Date.now(),pageUrl:window.location.href,target:g(o),data:{inputType:o.type||"text",value:e&&!w?f({str:o.value,maxLength:v}):void 0,length:o.value.length}}),r.delete(o)},l);r.set(o,n)})},A=t=>{let s=window.location.href;const e=a=>{const n=window.location.href;n!==s&&(t({type:c.NAVIGATE,timestamp:Date.now(),pageUrl:n,data:{from:s,to:n,trigger:a}}),s=n)},l=h(window,"popstate",()=>e(p.POPSTATE)),u=h(window,"hashchange",()=>e(p.HASHCHANGE)),d=history.pushState,o=history.replaceState;return history.pushState=function(...a){const n=d.apply(this,a);return e(p.PUSH_STATE),n},history.replaceState=function(...a){const n=o.apply(this,a);return e(p.REPLACE_STATE),n},()=>{l(),u(),history.pushState=d,history.replaceState=o}},E=(t,s)=>{const{throttleMs:e=200,sampleRate:i=1}=s||{},l=S({cb:()=>{i<1&&Math.random()>i||t({type:c.SCROLL,timestamp:Date.now(),pageUrl:window.location.href,data:{scrollTop:document.documentElement.scrollTop||document.body.scrollTop,scrollLeft:document.documentElement.scrollLeft||document.body.scrollLeft,scrollHeight:document.documentElement.scrollHeight,scrollWidth:document.documentElement.scrollWidth,viewportHeight:window.innerHeight,viewportWidth:window.innerWidth}})},duration:e,immediate:!0});return h(window,"scroll",l,{passive:!0})},U=t=>h(document,"visibilitychange",()=>{t({type:c.CUSTOM,timestamp:Date.now(),pageUrl:window.location.href,data:{event:"visibilitychange",visible:document.visibilityState==="visible",visibilityState:document.visibilityState}})});class k{options;stoppers=[];behaviors=[];running=!1;constructor(s={}){this.options=s}observe=s=>{if(this.running)return()=>{};this.running=!0;const e=i=>{this.addBehavior(i),s(i)};return this.options.click!==!1&&this.stoppers.push(C(e,this.options.clickOptions)),this.options.scroll!==!1&&this.stoppers.push(E(e,this.options.scrollOptions)),this.options.input!==!1&&this.stoppers.push(L(e,this.options.inputOptions)),this.options.routeChange!==!1&&this.stoppers.push(A(e)),this.stoppers.push(U(e)),()=>this.stop()};stop=()=>{this.stoppers.forEach(s=>s()),this.stoppers=[],this.running=!1};addBehavior=s=>{const e=this.options.maxBehaviors??T;this.behaviors.push(s),this.behaviors.length>e&&(this.behaviors=this.behaviors.slice(-e))};getBehaviors=()=>[...this.behaviors];clear=()=>{this.behaviors=[]};trackCustom=(s,e)=>{const i={type:c.CUSTOM,timestamp:Date.now(),pageUrl:typeof window<"u"?window.location.href:"",data:{name:s,...e}};return this.addBehavior(i),i};isRunning=()=>this.running}export{k as B,L as a,A as b,E as c,U as d,C as o};
