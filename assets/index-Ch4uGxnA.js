import{a as u}from"./index-DIcNE1hc.js";import{E as a}from"./interface-l7xTqOLs.js";import{c as m}from"./performanceObserver-wogupI_g.js";const T=50;class d{longTaskEntries=[];stopObserver=null;parseLongTaskEntry=t=>{const r=(t.attribution||[]).map(n=>({containerType:n.containerType,containerId:n.containerId,containerName:n.containerName,containerSrc:n.containerSrc}));return{name:t.name,startTime:t.startTime,duration:t.duration,attribution:r}};handleEntry=(t,r,n)=>{if(t.duration<r)return;const e=this.parseLongTaskEntry(t);this.longTaskEntries.push(e),n?.(e)};reportExistingEntries=(t,r)=>{for(const n of this.longTaskEntries)n.duration<t||r(n)};getEntriesFromPerformanceAPI=()=>u(a.LONGTASK)?performance.getEntriesByType(a.LONGTASK).map(this.parseLongTaskEntry):[];computeStats=t=>{if(t.length===0)return{count:0,totalDuration:0,maxDuration:0,avgDuration:0,entries:[]};let r=0,n=0;for(const e of t)r+=e.duration,e.duration>n&&(n=e.duration);return{count:t.length,totalDuration:r,maxDuration:n,avgDuration:r/t.length,entries:t}};observe=(t,r)=>{const{threshold:n=T,reportExisting:e=!0}=r||{};if(!u(a.LONGTASK))return console.warn("[longTaskMonitor] Long Task API is not supported"),()=>{};e&&t&&this.reportExistingEntries(n,t);const{stop:s}=m(a.LONGTASK,i=>{for(const o of i)this.handleEntry(o,n,t)});return this.stopObserver=s,s};stop=()=>{this.stopObserver?.(),this.stopObserver=null};clear=()=>{this.longTaskEntries=[]};getEntries=()=>[...this.longTaskEntries];getStats=()=>{const t=this.longTaskEntries.length>0?this.longTaskEntries:this.getEntriesFromPerformanceAPI();return this.computeStats(t)};calculateTBT=(t,r)=>{const n=this.longTaskEntries.length>0?this.longTaskEntries:this.getEntriesFromPerformanceAPI(),e=t??0,s=r??performance.now();let i=0;for(const o of n){const g=o.startTime+o.duration;if(!(o.startTime>=e&&g<=s))continue;const c=o.duration-T;c<=0||(i+=c)}return i}}export{d as L};
