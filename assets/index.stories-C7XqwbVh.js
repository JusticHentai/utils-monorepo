import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as v}from"./iframe-BWchUvSv.js";import{i as j}from"./index-DosksGiu.js";import{i as z}from"./index-CJdN4_AW.js";import{i as N}from"./index-DbXIB-0m.js";import{u as p}from"./index-BwkVKYKJ.js";import{u as L}from"./index-BiJVgYx7.js";import{u as A}from"./index-DCvixTQf.js";/* empty css              */import"./preload-helper-PPVm8Dsz.js";import"./index-BtXwjIh0.js";import"./index-B0IsmQno.js";import"./index-CBBZs1mf.js";const f="ELEMENT_UTILS_SYNC_STORAGE_EVENT_NAME";function b(t){function a(s,n={}){let i;const{listenStorageChange:C=!1,onError:m=r=>{console.error(r)}}=n;try{i=t()}catch(r){m(r)}const k=r=>n.serializer?n.serializer(r):JSON.stringify(r),E=r=>n.deserializer?n.deserializer(r):JSON.parse(r);function u(){try{const r=i?.getItem(s);if(r)return E(r)}catch(r){m(r)}return j(n.defaultValue)?n.defaultValue():n.defaultValue}const[S,x]=v.useState(u);A(()=>{x(u())},[s]);const _=r=>{const g=j(r)?r(S):r;C||x(g);try{let c;const V=i?.getItem(s);z(g)?(c=null,i?.removeItem(s)):(c=k(g),i?.setItem(s,c)),dispatchEvent(new CustomEvent(f,{detail:{key:s,newValue:c,oldValue:V,storageArea:i}}))}catch(c){m(c)}},h=r=>{r.key!==s||r.storageArea!==i||x(u())},T=r=>{h(r.detail)};return p("storage",h),p(f,T),[S,L(_)]}return a}const l=b(()=>N()?localStorage:void 0),O=b(()=>N()?sessionStorage:void 0),{action:o}=__STORYBOOK_MODULE_ACTIONS__,D=()=>{const[t,a]=l("storybook-demo-message",{defaultValue:"Hello"});return e.jsxs("div",{children:[e.jsx("h4",{children:"useLocalStorageState"}),e.jsx("div",{className:"button",onClick:()=>{a("World"),o("useLocalStorageState")("设置值为 World")},children:'设置为 "World"'}),e.jsx("div",{className:"button",onClick:()=>{a(s=>`${s}!`),o("useLocalStorageState")("追加感叹号")},children:"追加感叹号"}),e.jsx("div",{className:"button",onClick:()=>{a(void 0),o("useLocalStorageState")("清除值（从 localStorage 移除）")},children:"清除值"}),e.jsx("div",{className:"area",children:e.jsx("div",{className:"card",children:t??"(空)"})})]})},B=()=>{const[t,a]=O("storybook-demo-count",{defaultValue:0});return e.jsxs("div",{children:[e.jsx("h4",{children:"useSessionStorageState"}),e.jsx("div",{className:"button",onClick:()=>{a(s=>(s??0)+1),o("useSessionStorageState")("计数 +1")},children:"计数 +1"}),e.jsx("div",{className:"button",onClick:()=>{a(0),o("useSessionStorageState")("重置计数")},children:"重置计数"}),e.jsx("div",{className:"area",children:e.jsxs("div",{className:"card",children:["计数: ",t]})})]})},U=()=>{const[t,a]=l("storybook-demo-custom",{defaultValue:{name:"张三",age:25},serializer:s=>btoa(JSON.stringify(s)),deserializer:s=>JSON.parse(atob(s)),onError:s=>o("自定义序列化错误")(String(s))});return e.jsxs("div",{children:[e.jsx("h4",{children:"自定义序列化（Base64）"}),e.jsx("div",{className:"button",onClick:()=>{a({name:"李四",age:30}),o("自定义序列化")("使用 Base64 编码存储")},children:"设置数据"}),e.jsx("div",{className:"button",onClick:()=>{const s=localStorage.getItem("storybook-demo-custom");o("查看原始存储值")(s)},children:"查看 localStorage 原始值"}),e.jsx("div",{className:"area",children:e.jsx("div",{className:"card",children:t?`${t.name}, ${t.age}岁`:"(空)"})})]})},$=()=>{const[t,a]=l("storybook-demo-theme",{defaultValue:"light",listenStorageChange:!0});return e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"#999",marginBottom:8},children:"组件 A"}),e.jsx("div",{className:"button",onClick:()=>{const s=t==="light"?"dark":"light";a(s),o("组件A")(`切换主题为 ${s}`)},children:"切换主题"}),e.jsx("div",{className:"area",children:e.jsxs("div",{className:"card",style:{background:t==="dark"?"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:["当前主题: ",t]})})]})},w=()=>{const[t]=l("storybook-demo-theme",{defaultValue:"light",listenStorageChange:!0});return e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"#999",marginBottom:8},children:"组件 B（自动同步）"}),e.jsx("div",{className:"area",children:e.jsxs("div",{className:"card",style:{background:t==="dark"?"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:["同步主题: ",t]})})]})},I=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"跨组件通信（listenStorageChange）"}),e.jsx("p",{style:{fontSize:12,color:"#666",margin:"8px 0"},children:"两个组件共享同一个 key，开启 listenStorageChange 后，组件A修改值时组件B自动同步更新"}),e.jsxs("div",{className:"flex",children:[e.jsx($,{}),e.jsx(w,{})]})]}),M=()=>{const[t,a]=l("storybook-demo-fn-default",{defaultValue:()=>new Date().toLocaleString()});return e.jsxs("div",{children:[e.jsx("h4",{children:"函数式默认值"}),e.jsx("p",{style:{fontSize:12,color:"#666",margin:"8px 0"},children:"defaultValue 支持传入函数，仅在无缓存时执行一次（惰性初始化）"}),e.jsx("div",{className:"button",onClick:()=>{a(new Date().toLocaleString()),o("函数式默认值")("更新时间戳")},children:"更新时间戳"}),e.jsx("div",{className:"button",onClick:()=>{a(void 0),o("函数式默认值")("清除缓存，下次将重新初始化")},children:"清除缓存"}),e.jsx("div",{className:"area",children:e.jsx("div",{className:"card",children:t??"(空)"})})]})},F=()=>{const[t,a]=v.useState("user-a"),[s,n]=l(`storybook-demo-config-${t}`,{defaultValue:`${t} 的默认配置`});return e.jsxs("div",{children:[e.jsx("h4",{children:"动态 Key 切换"}),e.jsx("p",{style:{fontSize:12,color:"#666",margin:"8px 0"},children:"切换用户时 key 变化，自动读取对应用户的缓存数据"}),e.jsx("div",{className:"button",onClick:()=>a("user-a"),style:{opacity:t==="user-a"?1:.5},children:"用户 A"}),e.jsx("div",{className:"button",onClick:()=>a("user-b"),style:{opacity:t==="user-b"?1:.5},children:"用户 B"}),e.jsx("div",{className:"button",onClick:()=>{n(`${t} 修改于 ${new Date().toLocaleTimeString()}`),o("动态Key")(`更新 ${t} 的配置`)},children:"修改配置"}),e.jsx("div",{className:"area",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{children:t}),e.jsx("div",{className:"desc",children:s})]})})]})},y=()=>e.jsxs("div",{children:[e.jsx(D,{}),e.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #eee"}}),e.jsx(B,{}),e.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #eee"}}),e.jsx(U,{}),e.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #eee"}}),e.jsx(I,{}),e.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #eee"}}),e.jsx(M,{}),e.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #eee"}}),e.jsx(F,{})]});y.__docgenInfo={description:"",methods:[],displayName:"UseStorageStateDemo"};const te={title:"element-utils/useStorageState",component:y,parameters:{layout:"centered"},argTypes:{}},d={};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:"{}",...d.parameters?.docs?.source}}};const se=["Demo"];export{d as Demo,se as __namedExportsOrder,te as default};
