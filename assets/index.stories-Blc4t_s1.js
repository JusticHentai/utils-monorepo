import{j as i}from"./jsx-runtime-u17CrQMm.js";/* empty css              */import{a as d}from"./index-DFXbvB5D.js";import{r as F}from"./index-dIpHIJyx.js";import{t as y,E as u}from"./index-BJRB_Mgo.js";import{s as f}from"./index-BvINh1mj.js";const l=({fetchFn:t,retryCount:n=3,timeout:s=3e3})=>(...r)=>{const e=d(t),o=y({fn:e,timeout:s});return F({fn:o,retryCount:n})(...r)},{action:a}=__STORYBOOK_MODULE_ACTIONS__,O=async()=>{let t=0;const s=l({fetchFn:async o=>{throw t++,a("开始请求")(o,`第 ${t} 次尝试`),await f(500),a("请求失败")(o,`第 ${t} 次尝试`),new Error(`${o} error`)},retryCount:3,timeout:3e3}),[r,e]=await s("失败用例");e?e.errorType===u.TIMEOUT?a("请求失败用例 - 超时")({res:r,err:e,errMessage:e?.error?.message}):a("请求失败用例（重试 3 次后仍失败）")({res:r,err:e,errMessage:e?.error?.message}):a("请求失败用例 - 成功")({res:r,err:e})},{action:c}=__STORYBOOK_MODULE_ACTIONS__,T=async()=>{const n=l({fetchFn:async e=>(c("开始请求")(e),await f(500),c("请求完成")(e),`${e} success`),retryCount:3,timeout:3e3}),[s,r]=await n("成功用例");r?r.errorType===u.TIMEOUT?c("请求成功用例 - 超时")({res:s,err:r}):c("请求成功用例 - 错误")({res:s,err:r}):c("请求成功用例 - 成功")({res:s,err:r})},{action:m}=__STORYBOOK_MODULE_ACTIONS__,h=async()=>{let t=0;const s=l({fetchFn:async o=>(t++,m("开始请求")(o,`第 ${t} 次尝试`),await f(2e3),m("请求完成")(o,`第 ${t} 次尝试`),`${o} success`),retryCount:3,timeout:1e3}),[r,e]=await s("超时用例");e?e.errorType===u.TIMEOUT?m("超时用例（每次请求都超时，重试 3 次后返回超时错误）")({res:r,err:e,errMessage:e?.error?.message}):m("超时用例 - 普通错误")({res:r,err:e,errMessage:e?.error?.message}):m("超时用例 - 成功")({res:r,err:e})},_=()=>i.jsxs("div",{children:[i.jsx("div",{className:"button",onClick:T,children:"请求成功用例"}),i.jsx("div",{className:"button",onClick:O,children:"请求失败用例（重试后仍失败）"}),i.jsx("div",{className:"button",onClick:h,children:"超时用例"})]});_.__docgenInfo={description:"",methods:[],displayName:"fetchFormatDemo"};const j={title:"js-utils/fetchFormat",component:_,parameters:{layout:"centered"},argTypes:{}},p={};p.parameters={...p.parameters,docs:{...p.parameters?.docs,source:{originalSource:"{}",...p.parameters?.docs?.source}}};const I=["Demo"];export{p as Demo,I as __namedExportsOrder,j as default};
