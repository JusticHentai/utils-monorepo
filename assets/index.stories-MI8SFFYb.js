import{j as o}from"./jsx-runtime-u17CrQMm.js";/* empty css              */import{c as T}from"./intersectionObserver-CsuZ92MF.js";import{c as z}from"./mutationObserver-wiXghfWe.js";import{a as c}from"./index-DIcNE1hc.js";import{c as b}from"./performanceObserver-wogupI_g.js";import{g as j}from"./index-DZxKv9xf.js";import{c as P}from"./resizeObserver-CJMXqnqe.js";import"./index-CcKdPq4Q.js";import"./index-DbXIB-0m.js";import"./interface-Xy6dxNqB.js";import"./index-DHiFYDE3.js";import"./index-BpdpvJes.js";const{action:O}=__STORYBOOK_MODULE_ACTIONS__;let m=null;const R=()=>({initIntersection:()=>{m&&m();const a=document.querySelector("#observer-target");if(!a){O("错误")("未找到目标元素");return}const{stop:e,isActive:r}=T(a,({isIntersecting:t,intersectionRatio:s,target:i})=>{O("IntersectionObserver 回调")({isIntersecting:t,intersectionRatio:s.toFixed(2),targetId:i.id})},{threshold:[0,.25,.5,.75,1],rootMargin:"0px"});m=e,O("IntersectionObserver")({status:"已开始监听",isActive:r,说明:"滚动页面使目标元素进出视口，观察回调触发"})},stopIntersection:()=>{m&&(m(),m=null,O("IntersectionObserver")("已停止监听"))}}),{action:d}=__STORYBOOK_MODULE_ACTIONS__;let l=null,v=0;const I=()=>({initMutation:()=>{l&&l();const e=document.querySelector("#mutation-target");if(!e){d("错误")("未找到目标元素");return}const{stop:r,isActive:t}=z(e,s=>{s.forEach(i=>{d("MutationObserver 回调")({type:i.type,addedNodes:i.addedNodes.length,removedNodes:i.removedNodes.length,attributeName:i.attributeName,oldValue:i.oldValue})})},{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0});l=r,d("MutationObserver")({status:"已开始监听",isActive:t,说明:"点击触发 DOM 变化按钮查看效果"})},stopMutation:()=>{l&&(l(),l=null,d("MutationObserver")("已停止监听"))},triggerMutation:()=>{const e=document.querySelector("#mutation-target");if(!e){d("错误")("未找到目标元素");return}v++,e.setAttribute("data-count",String(v));const r=document.createElement("span");r.textContent=` [新增内容 ${v}]`,r.style.color="#007bff",e.appendChild(r),d("触发变化")({attributeChange:`data-count = ${v}`,childAdded:!0})}}),{action:u}=__STORYBOOK_MODULE_ACTIONS__,n=[],y=()=>({initPerformance:()=>{if(n.forEach(e=>e()),n.length=0,c("largest-contentful-paint")){const{stop:e}=b("largest-contentful-paint",r=>{const t=r[r.length-1];t&&u("LCP (最大内容绘制)")({time:Math.round(t.startTime)+"ms",size:t.size,element:t.element?.tagName,说明:"Largest Contentful Paint - 最大内容元素渲染时间"})});n.push(e)}if(c("longtask")){const{stop:e}=b("longtask",r=>{r.forEach(t=>{u("长任务")({duration:Math.round(t.duration)+"ms",startTime:Math.round(t.startTime)+"ms",说明:"超过 50ms 的任务会阻塞主线程"})})});n.push(e)}if(c("resource")){const{stop:e}=b("resource",r=>{r.forEach(t=>{const s=t;["img","script","css","fetch","xmlhttprequest"].includes(s.initiatorType)&&u("资源加载")({name:s.name.split("/").pop(),type:s.initiatorType,duration:Math.round(s.duration)+"ms",transferSize:s.transferSize+" bytes"})})});n.push(e)}u("PerformanceObserver")({status:"已开始监听",listeners:n.length,监听项:[c("largest-contentful-paint")&&"LCP",c("longtask")&&"长任务",c("resource")&&"资源加载"].filter(Boolean)})},initCustomPerformance:()=>{if(n.forEach(e=>e()),n.length=0,c("mark")){const{stop:e}=b("mark",r=>{r.forEach(t=>{u("Performance Mark")({name:t.name,startTime:Math.round(t.startTime)+"ms"})})});n.push(e)}if(c("measure")){const{stop:e}=b("measure",r=>{r.forEach(t=>{u("Performance Measure")({name:t.name,duration:Math.round(t.duration)+"ms",startTime:Math.round(t.startTime)+"ms"})})});n.push(e)}performance.mark("demo-start"),setTimeout(()=>{performance.mark("demo-end"),performance.measure("demo-duration","demo-start","demo-end")},100),u("自定义性能监控")({status:"已开始监听 mark 和 measure",说明:"可以用于自定义性能打点"})},stopPerformance:()=>{n.forEach(e=>e()),n.length=0,u("PerformanceObserver")("已停止所有监听")}}),{action:g}=__STORYBOOK_MODULE_ACTIONS__;let p=null;const E=()=>({initResize:()=>{p&&p();const a=document.querySelector("#observer-target");if(!a){g("错误")("未找到目标元素");return}const e=j(a);g("初始尺寸")(e);const{stop:r,isActive:t}=P(a,({width:s,height:i,borderBoxWidth:x,borderBoxHeight:_,devicePixelContentBoxWidth:k,devicePixelContentBoxHeight:N})=>{g("ResizeObserver 回调")({contentBox:{width:Math.round(s),height:Math.round(i)},borderBox:{width:Math.round(x),height:Math.round(_)},devicePixelContentBox:{width:Math.round(k),height:Math.round(N)}})});p=r,g("ResizeObserver")({status:"已开始监听",isActive:t,tip:"拖动目标元素右下角调整大小"})},stopResize:()=>{p&&(p(),p=null,g("ResizeObserver")("已停止监听"))}}),C=()=>{const{initIntersection:h,stopIntersection:f}=R(),{initMutation:a,stopMutation:e,triggerMutation:r}=I(),{initResize:t,stopResize:s}=E(),{initPerformance:i,initCustomPerformance:x,stopPerformance:_}=y();return o.jsxs("div",{style:{maxWidth:"700px"},children:[o.jsx("h3",{children:"IntersectionObserver - 元素可见性"}),o.jsx("div",{className:"button",onClick:h,children:"createIntersectionObserver"}),o.jsx("div",{className:"button",onClick:f,children:"停止监听"}),o.jsx("h3",{children:"MutationObserver - DOM 变化"}),o.jsx("div",{className:"button",onClick:a,children:"createMutationObserver"}),o.jsx("div",{className:"button",onClick:r,children:"触发 DOM 变化"}),o.jsx("div",{className:"button",onClick:e,children:"停止监听"}),o.jsx("h3",{children:"ResizeObserver - 尺寸变化"}),o.jsx("div",{className:"button",onClick:t,children:"createResizeObserver"}),o.jsx("div",{className:"button",onClick:s,children:"停止监听"}),o.jsx("h3",{children:"PerformanceObserver - 性能监控"}),o.jsx("div",{className:"button",onClick:i,children:"监听 Web Vitals"}),o.jsx("div",{className:"button",onClick:x,children:"监听 Mark/Measure"}),o.jsx("div",{className:"button",onClick:_,children:"停止监听"}),o.jsxs("div",{id:"observer-target",style:{marginTop:"20px",padding:"20px",border:"2px dashed #ccc",minHeight:"100px",resize:"both",overflow:"auto",background:"#fafafa"},children:[o.jsx("p",{style:{margin:"0 0 10px 0",fontWeight:"bold"},children:"目标元素（可调整大小）"}),o.jsx("div",{id:"mutation-target",style:{padding:"10px",background:"#fff",border:"1px solid #eee"},children:"可变内容区域"})]})]})};C.__docgenInfo={description:"",methods:[],displayName:"ObserverDemo"};const F={title:"element-utils/observer",component:C,parameters:{layout:"centered"},argTypes:{}},M={};M.parameters={...M.parameters,docs:{...M.parameters?.docs,source:{originalSource:"{}",...M.parameters?.docs?.source}}};const H=["Demo"];export{M as Demo,H as __namedExportsOrder,F as default};
