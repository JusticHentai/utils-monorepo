import{j as w}from"./jsx-runtime-u17CrQMm.js";import{r as f}from"./iframe-BNypc-Hr.js";const p=r=>{const{initialTime:t,initialFrame:e,duration:i,frameCount:n}=r,a=Date.now()-t,s=Math.floor(a/(i/n))+e,o=s%n,m=Math.floor(s/n);return{nextFrame:o,completedTimes:m}},F=r=>{const{canvas:t,frameCanvas:e,width:i,height:n}=r,a=t.getContext("2d");a.clearRect(0,0,i,n),a.drawImage(e,0,0,i,n)};class C{options;initialTime=0;initialFrame=0;currentFrame=-1;currentTimes=0;rafId;totalTimes=-1;constructor(t){this.options=t}start=t=>{this.rafId&&cancelAnimationFrame(this.rafId),this.initialTime=Date.now(),this.initialFrame=0,this.currentFrame=-1,this.currentTimes=0,this.totalTimes=t??-1,this.rafId=requestAnimationFrame(this.render)};resume=()=>{this.initialTime=Date.now(),this.rafId=requestAnimationFrame(this.render)};pause=()=>{const{frameCount:t,duration:e}=this.options,{initialFrame:i,initialTime:n,rafId:a}=this;a&&cancelAnimationFrame(a);const{nextFrame:s,completedTimes:o}=p({initialFrame:i,initialTime:n,duration:e,frameCount:t});this.initialFrame=s+o*t};render=()=>{const{frameCount:t,duration:e,canvasEl:i,frameList:n,width:a,height:s}=this.options,{currentFrame:o,initialFrame:m,initialTime:d,totalTimes:h}=this,{nextFrame:c,completedTimes:u}=p({initialFrame:m,initialTime:d,duration:e,frameCount:t});if(!n[c]){this.rafId=requestAnimationFrame(this.render);return}if(c===o){this.rafId=requestAnimationFrame(this.render);return}if(u!==this.currentTimes&&this.options.onCompleteOnce?.(this.currentTimes),h>0&&u>=h){this.options.onComplete?.(),this.pause();return}F({canvas:i,frameCanvas:n[c],width:a,height:s}),this.currentFrame=c,this.currentTimes=u,this.options.onFrame?.(c),this.rafId=requestAnimationFrame(this.render)}}const x=r=>{const{imageElement:t,frameCount:e,rowCount:i}=r,n=Math.ceil(e/i),a=t.width/n,s=t.height/i,o=[];for(let m=0;m<e;m++){const d=m%n*a,h=Math.floor(m/n)*s;o.push({left:d,top:h})}return{width:a,height:s,frameList:o}},v=r=>{const{height:t,width:e,canvas:i}=r;i.style.height=`${t}px`,i.style.width=`${e}px`;const n=window.devicePixelRatio||1;i.height=t*n,i.width=e*n,i.getContext("2d").scale(n,n)},I=r=>{const{width:t,height:e,left:i,top:n,imageEl:a}=r,s=document.createElement("canvas");return s.width=t,s.height=e,s.getContext("2d").drawImage(a,i,n,t,e,0,0,t,e),s},T=r=>new Promise(t=>{const e=new Image;e.crossOrigin="anonymous",e.src=r,e.onload=()=>t(e),e.onerror=()=>t(void 0)});class E{options;imageElement;frameState={width:0,height:0};frameList=[];constructor(t){this.options=t}preRender=async()=>{const t=await this.loadImage();if(!t)return;const{frameCount:e,rowCount:i}=this.options,{width:n,height:a,frameList:s}=x({imageElement:t,frameCount:e,rowCount:i});this.frameState={width:n,height:a},this.frameList=s.map(o=>({canvas:I({width:n,height:a,left:o.left,top:o.top,imageEl:t}),...o}))};createInstance=t=>{const{width:e,height:i}=t.getBoundingClientRect(),n=document.createElement("canvas");v({width:e,height:i,canvas:n}),t.appendChild(n);const a=this.frameList.map(s=>s.canvas);return new C({...this.options,canvasEl:n,width:e,height:i,frameList:a})};loadImage=async()=>(this.imageElement=await T(this.options.imageUrl),this.imageElement)}const A=""+new URL("image-l8ygEwMG.png",import.meta.url).href,g=()=>{const r=f.useRef(null),t=async()=>{const e=new E({imageUrl:A,frameCount:20,duration:2e4,rowCount:4});await e.preRender(),e.createInstance(r.current).start()};return f.useEffect(()=>{t()},[]),w.jsx("div",{ref:r,children:"FrameAnimation"})};g.__docgenInfo={description:"",methods:[],displayName:"Demo"};const L={title:"element-utils/FrameAnimation",component:g,tags:["autodocs"],parameters:{layout:"centered"},argTypes:{}},l={};l.parameters={...l.parameters,docs:{...l.parameters?.docs,source:{originalSource:"{}",...l.parameters?.docs?.source}}};const D=["Demo"];export{l as Demo,D as __namedExportsOrder,L as default};
