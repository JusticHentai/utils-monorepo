import{c as d}from"./index-BINnBmJz.js";import{g as l}from"./index-nL6JsiBQ.js";import{i as I}from"./index-DbXIB-0m.js";import{o as m}from"./index-B_-fQMag.js";import{s as g}from"./index-D2Y4DYgy.js";import{u}from"./index-CiAGgNxw.js";import{v as y}from"./index-BecUxZRD.js";const f=async(t,s)=>{try{return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),keepalive:!0})).ok}catch{return!1}},b=async(t,s)=>{if(!navigator.sendBeacon)return f(t,s);try{const r=new Blob([JSON.stringify(s)],{type:"application/json"});return navigator.sendBeacon(t,r)?!0:f(t,s)}catch{return f(t,s)}},B=(t,s)=>{try{const r=new Image,e=encodeURIComponent(JSON.stringify(s));return r.src=`${t}?data=${e}`,!0}catch{return!1}},S=(t,s)=>new Promise(r=>{const e=new XMLHttpRequest;e.open("POST",t,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=()=>{e.readyState===4&&r(e.status>=200&&e.status<300)},e.onerror=()=>r(!1);try{e.send(JSON.stringify(s))}catch{r(!1)}});var i=(t=>(t.BEACON="beacon",t.FETCH="fetch",t.XHR="xhr",t.IMG="img",t))(i||{}),w=(t=>(t.PERFORMANCE="performance",t.ERROR="error",t.REQUEST="request",t.BEHAVIOR="behavior",t.CUSTOM="custom",t))(w||{}),v=(t=>(t.WEB_VITALS="webVitals",t.NAVIGATION="navigation",t.RESOURCE="resource",t.LONG_TASK="longTask",t.PAINT="paint",t.FPS="fps",t.JANK="jank",t))(v||{});class j{sessionId;pageId;options;batch;constructor(s){const{reportMethod:r=i.BEACON,batchSize:e=10,reportInterval:n=5e3}=s;this.options={...s,reportMethod:r},this.sessionId=g(),this.pageId=u(),this.batch=d(p=>this.send(p),{batchSize:e,batchDelay:n}),this.bindLifecycle()}report=(s,r,e=!1)=>{const n={type:s,appId:this.options.appId,sessionId:this.sessionId,pageId:this.pageId,timestamp:Date.now(),pageInfo:l(),data:r};if(e){this.send([n]);return}this.batch.add([n])};flush=()=>{this.batch.flush()};updatePageInfo=()=>{this.pageId=u()};send=async s=>{const{reportUrl:r,reportMethod:e,beforeReport:n,afterReport:p}=this.options,a=s.map(o=>{if(!n)return o;const h=n(o);return h===!1?null:h}).filter(o=>o!==null);if(a.length===0)return;let c=!1;e===i.BEACON&&(c=await b(r,a)),e===i.FETCH&&(c=await f(r,a)),e===i.XHR&&(c=await S(r,a)),e===i.IMG&&(c=B(r,a)),p&&a.forEach(o=>p(o,c))};bindLifecycle=()=>{I()&&(m(()=>this.batch.flush()),y({hidden:()=>this.batch.flush()}))}}export{v as P,j as R,i as a,w as b};
